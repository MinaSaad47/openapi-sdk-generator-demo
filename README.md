
You know what is better than giving you **front-end** colleagues a hand-made postman collections :) ? the URL of you **back-end** Open API docs. You will not only give them a way to try you API quickly, will give them away to use it to generate the postman collection. Or even better generating client-side SDKs.

There are a lot of libraries/cli-tools that take your Open API URL and generate DTO types and Services you can use to call your back-end. Some of them integrate with you favorite state management libraries as well.

In this post, I'll show how can create your own client with tanstack query hooks. I'll be using .NET as the back-end and ReactJS as the front-end.


Since .NET 9 comes out of the box with Open API support, no need to do any thing about the back-end in in terms of installing libraries. Just generate a simple `webapi` project and add 2 controller endpoints (GET /products, POST /products)

```cs
[ApiController]
[Route("[controller]")]
public class ProductsController : ControllerBase
{
    private static readonly ConcurrentBag<Product> _products = InitializeProducts();

    public static ConcurrentBag<Product> InitializeProducts()
    {
        return
        [
            new Product()
            {
                Id = Guid.CreateVersion7(),
                Title = "Mobile Phone",
                Price = 55 * 1000,
                Description = "Mobile Phone Description",
            },
            new Product()
            {
                Id = Guid.CreateVersion7(),
                Title = "Laptop",
                Price = 120 * 1000,
                Description = "Laptop Description",
            },
        ];
    }

    [HttpGet(Name = "GetProducts")] // You need to specify the name to be used in the OpenAPI spec as OperationId
    public ActionResult<List<Product>> GetProducts()
    {
        return Ok(_products);
    }

    [HttpPost(Name = "CreateProduct")]
    public ActionResult<Product> CreateProduct(Product product)
    {
        _products.Add(product);
        return CreatedAtAction(nameof(GetProducts), product);
    }
}
```


for ReactJS. we need to install hey-api, axios, tanstack-query

```bash
pnpm add @hey-api/openapi-ts -D -E
pnpm add @tanstack/react-query axios
```


the hey-api library expects the config file `openapi-ts.config.ts`

```ts
import { defineConfig } from "@hey-api/openapi-ts";

export default defineConfig({
  input: "http://localhost:5000/openapi/v1.json", // put your OpenAPI spec URL here
  output: "src/client", // put your output directory here
  plugins: ["@hey-api/client-axios", "@tanstack/react-query"],
});

```

Then execute the library's cli tool to generate you SDK

```bash
npx openapi-ts # will generate the SDK in src/client
```

And now we can use it

1st think we need to do is to set the baseURL

```ts
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { createRoot } from "react-dom/client";
import App from "./App.tsx";
import { client } from "./client/client.gen.ts";
import "./index.css";

client.setConfig({
  baseURL: "http://localhost:5000",
});
```

And here is the code for using axios and useEffect

```ts
import { useEffect, useState } from "react";
import AdProductForm from "./add-product-form";
// as you can see, we are using the methods and types generated by hey-api
import { getProducts, type Product } from "./client";

const ProductsListViaClient = () => {
  const [products, setProducts] = useState<Product[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  // Please use tanstack/query instead of useEffect for any async operations to avoid a lot of bugs
  useEffect(() => {
    const fetchProducts = async () => {
      try {
        setIsLoading(true);
        // getProduct is the same as the Operation Id
        const response = await getProducts();
        setProducts(response.data || []);
      } catch (err) {
        setError("Failed to fetch products");
        console.error("Error fetching products:", err);
      } finally {
        setIsLoading(false);
      }
    };

    fetchProducts();
  }, []);

/* skipped for brevity */
};
  
```

For integrating with @tanstack/query, here is how to the post endpoint in a useMutation hook

```ts
import { useMutation, useQueryClient } from "@tanstack/react-query";
import React from "react";
import {
  createProductMutation,
  getProductsQueryKey,
} from "./client/@tanstack/react-query.gen";

const AdProductForm = () => {
  const queryClient = useQueryClient();

  const addProduct = useMutation({
    ...createProductMutation(),
    onSettled() {
      queryClient.invalidateQueries({
        queryKey: getProductsQueryKey(), // if you we've used tanstack/query for getting the products this will actually update the cache
      });
    },
  });

  const [fields, setFields] = React.useState({
    title: "",
    description: "",
    price: 0,
  });

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    addProduct.mutate({
      body: {
        id: crypto.randomUUID(),
        title: fields.title,
        description: fields.description,
        price: Math.floor(fields.price * 100),
      },
    });
  };
 /* skipped for brevity */ 
}
```

That's not all if your back-end can generate Open API schema for your polymorphic types. the library can utilize that to generate discriminated TS union types 


```cs
using System.Text.Json.Serialization;

[JsonPolymorphic(TypeDiscriminatorPropertyName = "type")]
[JsonDerivedType(typeof(Student), "student")]
[JsonDerivedType(typeof(Teacher), "teacher")]
public abstract record User
{
    public required Guid Id { get; init; }
    public required string Name { get; init; }
    public required string Email { get; init; }
}

public record Student : User
{
    public required decimal GPA { get; init; }
    public required string Major { get; init; }
}

public record Teacher : User
{
    public required string Department { get; init; }
    public required int YearsOfExperience { get; init; }
}
```

```cs
[ApiController]
[Route("[controller]")]
public class UsersController : ControllerBase
{
    [HttpGet(Name = "GetUsers")]
    public ActionResult<List<User>> GetUsers()
    {
        List<User> users =
        [
            new Student()
            {
                Id = Guid.CreateVersion7(),
                Name = "John Doe",
                Email = "a@b.com",
                GPA = 3.5m,
                Major = "Computer Science"
            },
            new Teacher()
            {
                Id = Guid.CreateVersion7(),
                Name = "Jane Doe",
                Email = "c@d.com",
                Department = "Mathematics",
                YearsOfExperience = 10
            },
        ];

        return Ok(users);
    }
}
```

you will notice in OpenAPI docs the following:
```json
{
    /* skipped for brevity */

    "User": {
        "required": [
          "type"
        ],
        "type": "object",
        "anyOf": [
          {
            "$ref": "#/components/schemas/UserStudent"
          },
          {
            "$ref": "#/components/schemas/UserTeacher"
          }
        ],
        "discriminator": {
          "propertyName": "type",
          "mapping": {
            "student": "#/components/schemas/UserStudent",
            "teacher": "#/components/schemas/UserTeacher"
          }
        }
      },

      /* skipped for brevity */
}
```


![[image-10.png]]

```ts
/* skipped for brevity */

function UsersListViaQueryOptions() {
  const users = useQuery({
    ...getUsersOptions(),
    refetchInterval: 3 * 1000,
  });

  if (users.isPending) {
    return (
      <div className='flex items-center justify-center mt-10'>
        <div className='animate-spin h-10 w-10 border-b-4 border-blue-500 rounded-full'></div>
      </div>
    );
  }

  if (users.isError) {
    return (
      <div className='flex items-center justify-center mt-10'>
        <div className='text-red-500 text-lg'>Error loading users</div>
      </div>
    );
  }

  return (
    <div className='bg-linear-to-br from-slate-50 to-blue-50 py-8 px-4'>
      <div className='max-w-7xl mx-auto'>
        <div className='text-center mb-12'>
          <h1 className='text-5xl font-bold bg-linear-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-4'>
            Our Users
          </h1>
        </div>

        <div className='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6'>
          {users.data.map((user) =>
            user.type === "student" ? ( // user will contain { type: "student", id: "...", name: "...", email: "...", gpa: "...", major: "..." }
              <StudentItem key={user.id} student={user} />
            ) : user.type === "teacher" ? ( // user will contain { type: "teacher", id: "...", name: "...", email: "...", department: "...", yearsOfExperience: "..." }
              <TeacherItem key={user.id} teacher={user} />
            ) : null
          )}
        </div>
      </div>
    </div>
  );
}

/* skipped for brevity */
```