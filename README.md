# Open API SDK Generator Demo

![Demo Image](image.png)

You know what’s better than giving your **front-end** colleagues hand-made Postman collections? :) The URL of your **back-end** Open API docs! Not only does it give them a way to try your API quickly, but it also allows them to generate Postman collections—or even better, client-side SDKs.

There are many libraries and CLI tools that take your Open API URL and generate DTO types and services you can use to call your back-end. Some even integrate with your favorite state management libraries.

In this post, I’ll show how you can create your own client with TanStack Query hooks. I’ll be using .NET for the back-end and ReactJS for the front-end.

---

Since .NET 9 comes with Open API support out of the box, there’s no need to install extra libraries for the back-end. Just generate a simple `webapi` project and add two controller endpoints (`GET /products` and `POST /products`):

```cs
[ApiController]
[Route("[controller]")]
public class ProductsController : ControllerBase
{
    private static readonly ConcurrentBag<Product> _products = InitializeProducts();

    public static ConcurrentBag<Product> InitializeProducts()
    {
        // Initialize some sample products
        return new ConcurrentBag<Product>
        {
            new Product()
            {
                Id = Guid.CreateVersion7(),
                Title = "Mobile Phone",
                Price = 55_000,
                Description = "Mobile Phone Description",
            },
            new Product()
            {
                Id = Guid.CreateVersion7(),
                Title = "Laptop",
                Price = 120_000,
                Description = "Laptop Description",
            },
        };
    }

    [HttpGet(Name = "GetProducts")] // You need to specify the name to be used in the OpenAPI spec as OperationId
    public ActionResult<List<Product>> GetProducts()
    {
        return Ok(_products);
    }

    [HttpPost(Name = "CreateProduct")]
    public ActionResult<Product> CreateProduct(Product product)
    {
        _products.Add(product);
        return CreatedAtAction(nameof(GetProducts), product);
    }
}
````

---

For ReactJS, install `hey-api`, `axios`, and `@tanstack/react-query`:

```bash
pnpm add @hey-api/openapi-ts -D -E
pnpm add @tanstack/react-query axios
```

The `hey-api` library expects a config file `openapi-ts.config.ts`:

```ts
import { defineConfig } from "@hey-api/openapi-ts";

export default defineConfig({
  input: "http://localhost:5000/openapi/v1.json", // put your OpenAPI spec URL here
  output: "src/client", // put your output directory here
  plugins: ["@hey-api/client-axios", "@tanstack/react-query"],
});
```

Then run the CLI tool to generate your SDK:

```bash
npx openapi-ts # will generate the SDK in src/client
```

---

Next, set the `baseURL` for the client:

```ts
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { createRoot } from "react-dom/client";
import App from "./App.tsx";
import { client } from "./client/client.gen.ts";
import "./index.css";

client.setConfig({
  baseURL: "http://localhost:5000",
});
```

Here’s an example using Axios and `useEffect`:

```ts
import { useEffect, useState } from "react";
import AdProductForm from "./add-product-form";
// as you can see, we are using the methods and types generated by hey-api
import { getProducts, type Product } from "./client";

const ProductsListViaClient = () => {
  const [products, setProducts] = useState<Product[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  // Please use tanstack/query instead of useEffect for any async operations to avoid a lot of bugs
  useEffect(() => {
    const fetchProducts = async () => {
      try {
        setIsLoading(true);
        // getProducts is the same as the OperationId
        const response = await getProducts();
        setProducts(response.data || []);
      } catch (err) {
        setError("Failed to fetch products");
        console.error("Error fetching products:", err);
      } finally {
        setIsLoading(false);
      }
    };

    fetchProducts();
  }, []);

  /* skipped for brevity */
};
```

---

To integrate with `@tanstack/react-query` for mutations:

```ts
import { useMutation, useQueryClient } from "@tanstack/react-query";
import React from "react";
import {
  createProductMutation,
  getProductsQueryKey,
} from "./client/@tanstack/react-query.gen";

const AdProductForm = () => {
  const queryClient = useQueryClient();

  const addProduct = useMutation({
    ...createProductMutation(),
    onSettled() {
      queryClient.invalidateQueries({
        queryKey: getProductsQueryKey(), // if we've used tanstack/query for getting the products this will actually update the cache
      });
    },
  });

  const [fields, setFields] = React.useState({
    title: "",
    description: "",
    price: 0,
  });

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    addProduct.mutate({
      body: {
        id: crypto.randomUUID(),
        title: fields.title,
        description: fields.description,
        price: Math.floor(fields.price * 100),
      },
    });
  };

  /* skipped for brevity */
};
```

---

If your back-end generates Open API schemas for polymorphic types, `hey-api` can generate discriminated TypeScript union types:

```cs
using System.Text.Json.Serialization;

[JsonPolymorphic(TypeDiscriminatorPropertyName = "type")]
[JsonDerivedType(typeof(Student), "student")]
[JsonDerivedType(typeof(Teacher), "teacher")]
public abstract record User
{
    public required Guid Id { get; init; }
    public required string Name { get; init; }
    public required string Email { get; init; }
}

public record Student : User
{
    public required decimal GPA { get; init; }
    public required string Major { get; init; }
}

public record Teacher : User
{
    public required string Department { get; init; }
    public required int YearsOfExperience { get; init; }
}
```

```cs
[ApiController]
[Route("[controller]")]
public class UsersController : ControllerBase
{
    [HttpGet(Name = "GetUsers")]
    public ActionResult<List<User>> GetUsers()
    {
        List<User> users =
        [
            new Student()
            {
                Id = Guid.CreateVersion7(),
                Name = "John Doe",
                Email = "a@b.com",
                GPA = 3.5m,
                Major = "Computer Science"
            },
            new Teacher()
            {
                Id = Guid.CreateVersion7(),
                Name = "Jane Doe",
                Email = "c@d.com",
                Department = "Mathematics",
                YearsOfExperience = 10
            },
        ];

        return Ok(users);
    }
}
```

You’ll notice the following in the OpenAPI docs:

```json
{
  "User": {
    "required": ["type"],
    "type": "object",
    "anyOf": [
      { "$ref": "#/components/schemas/UserStudent" },
      { "$ref": "#/components/schemas/UserTeacher" }
    ],
    "discriminator": {
      "propertyName": "type",
      "mapping": {
        "student": "#/components/schemas/UserStudent",
        "teacher": "#/components/schemas/UserTeacher"
      }
    }
  }
}
```

---

Finally, using `useQuery` with the generated options:

```ts
/* skipped for brevity */

function UsersListViaQueryOptions() {
  const users = useQuery({
    ...getUsersOptions(),
    refetchInterval: 3 * 1000,
  });

  if (users.isPending) {
    return (
      <div className='flex items-center justify-center mt-10'>
        <div className='animate-spin h-10 w-10 border-b-4 border-blue-500 rounded-full'></div>
      </div>
    );
  }

  if (users.isError) {
    return (
      <div className='flex items-center justify-center mt-10'>
        <div className='text-red-500 text-lg'>Error loading users</div>
      </div>
    );
  }

  return (
    <div className='bg-linear-to-br from-slate-50 to-blue-50 py-8 px-4'>
      <div className='max-w-7xl mx-auto'>
        <div className='text-center mb-12'>
          <h1 className='text-5xl font-bold bg-linear-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-4'>
            Our Users
          </h1>
        </div>

        <div className='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6'>
          {users.data.map((user) =>
            user.type === "student" ? ( // user will contain { type: "student", id: "...", name: "...", email: "...", gpa: "...", major: "..." }
              <StudentItem key={user.id} student={user} />
            ) : user.type === "teacher" ? ( // user will contain { type: "teacher", id: "...", name: "...", email: "...", department: "...", yearsOfExperience: "..." }
              <TeacherItem key={user.id} teacher={user} />
            ) : null
          )}
        </div>
      </div>
    </div>
  );
}

/* skipped for brevity */
```